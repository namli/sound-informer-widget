# Active Context: Sound Informer Widget

## Current Work Focus

Проект находится на начальной стадии разработки. Создана базовая структура проекта с React + TypeScript + Vite, но основные компоненты виджета еще не реализованы.

Текущий статус: инфраструктура проекта настроена, требуется реализация основных компонентов согласно техническому заданию.

## Recent Changes

- Создана базовая структура проекта с React 19.x, TypeScript 5.x, Vite 7.x
- Настроена структура папок согласно техническому заданию
- Создан Memory Bank для документирования проекта
- Подготовлено техническое задание с детальными требованиями

## Next Steps

### Приоритет 1: Инфраструктура
- [ ] Установка зависимостей (Tailwind CSS 4.x, shadcn/ui, mapbox-gl, react-map-gl, recharts)
- [ ] Настройка Tailwind CSS 4.x
- [ ] Инициализация shadcn/ui
- [ ] Настройка Vite library mode для сборки виджета
- [ ] Проверка базовой структуры папок

### Приоритет 2: Основные компоненты
- [ ] Компонент MapView с react-map-gl
- [ ] Компонент SensorMarker с цветовой индикацией
- [ ] Компонент NoisePopup
- [ ] Компонент NoiseChart (столбчатый график)
- [ ] Главный компонент SoundInformerWidget

### Приоритет 3: API и интеграция
- [ ] Entry point widget.tsx
- [ ] Глобальный объект SoundInformer
- [ ] Методы init() и destroy()
- [ ] Обработка конфигурации

### Приоритет 4: Данные и локализация
- [ ] Фейковые данные датчиков (mockSensors.ts)
- [ ] Генерация данных графика
- [ ] Поддержка локализации (en, fr, es, ru)

## Active Decisions and Considerations

### Технические решения:
1. **Vite Library Mode** — выбран для сборки виджета в один JS файл (IIFE формат)
2. **React 19.x** — использование последней версии React для современных возможностей
3. **Tailwind CSS 4.x** — для стилизации с поддержкой префиксов для изоляции стилей
4. **shadcn/ui** — для готовых UI компонентов (card, button)
5. **Mapbox GL** — для интерактивной карты (через react-map-gl)
6. **Recharts** — для графиков (совместим с shadcn)

### Архитектурные решения:
1. **Изоляция стилей** — использование префикса `si-` для всех классов
2. **Mock данные** — использование фейковых данных на первом этапе
3. **Глобальный API** — экспорт через `window.SoundInformer` для простой интеграции

### Вопросы для решения:
- Нужна ли поддержка Shadow DOM для полной изоляции стилей?
- Как обрабатывать ошибки при инициализации (неверный токен, отсутствие контейнера)?
- Нужна ли поддержка темной темы на первом этапе?

## Important Patterns and Preferences

### Структура компонентов:
- Компоненты в папке `src/components/`
- UI компоненты shadcn в `src/ui/`
- Типы в `src/types/index.ts`
- Утилиты в `src/lib/utils.ts`
- Данные в `src/data/mockSensors.ts`

### Стилизация:
- Использование Tailwind CSS классов
- Префикс `si-` для всех классов виджета
- CSS Variables для темизации (если потребуется)

### Типизация:
- Строгая типизация TypeScript
- Интерфейсы для всех данных (Sensor, NoiseReading, SoundInformerConfig)
- Экспорт типов для использования в других файлах

## Learnings and Project Insights

### Из технического задания:
1. **Безопасность Mapbox токена** — критически важно настроить URL restrictions для Public token
2. **Адаптивность** — поддержка различных способов задания высоты (фиксированная, vh, aspect-ratio)
3. **Локализация** — автоматическое определение локали из браузера с fallback на 'en'
4. **Mock данные** — датчики расположены в трех городах: Париж, Барселона, Дахаб

### Требования к хост-сайту:
- Контейнер автоматически занимает 100% ширины
- Высота настраивается через параметр `height` в конфигурации
- Поддержка ES6+ в браузере
- Доступ к интернету для загрузки тайлов Mapbox

### Ограничения текущей версии:
- Данные фейковые (mock), backend не реализован
- Нет real-time обновлений
- Нет истории измерений (только последние 24 часа)
- Нет фильтрации/поиска датчиков
